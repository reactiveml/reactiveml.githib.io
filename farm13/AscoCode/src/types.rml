(***************************************************************)
(*                        Reactive Asco                        *)
(*                                                             *)
(*                                                             *)
(* Type definitions for Asco                                   *)
(***************************************************************)

(* Alias for readability *)
type delay = float
type label = int
type tempo = float
type point = float

(* Atomic action *)
type action =
  | Message of string  (* Max/MSP control message *)
  | Signal of (unit,unit list) event (* RML signal *)

(* Synchronization strategies *)
type sync = Tight | Loose

(* Error handling strategies *)
type err = Local | Global | Causal | Partial

type sequence =  (delay * asco_event) list

(* Generic asco event *)
and asco_event =
  | Group of group
  | Action of action
  | Until of asco_until

(* Asco group *)
and group =
      { group_synchro : sync;
	group_error : err;
	group_seq : sequence }

(* Preemption construct *)
and asco_until =
    { until_seq : sequence;
      until_event : label; }

(* Electronic score event *)
type score_event =
    { event : label;
      seq : sequence; }

(* Instrumental score, play the role of function E *)
type instr_score = delay list

(* type instr_score_map = (label, delay) Reactive_map.t *)

(* Electronic score *)
type score = score_event list * instr_score

(* Instrumental event *)
type instr_event =
    { index : label;
      bps : float; }

(* Status for an event *)
type status = Detected | Missed of label

(* Performance element *)
type perf_elem = label * delay * action

(* Simulation of the listening machine *)
type simulation = (label * delay * tempo) list
